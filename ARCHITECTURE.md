# 三国·天命 (Sanguo: Destiny) — Architecture

## 差异化核心：「天命系统」
> AFK Arena = 挂机升级 + 抽卡合成
> 我们 = **选择改变命运** + 战棋策略 + 三国真实剧情分支

### 为什么不一样？
| 维度 | 剑与远征 | 三国·天命 |
|------|---------|----------|
| 战斗 | 自动放置 | **半自动+手动技能释放** |
| 阵容 | 种族克制 | **兵种+地形+天气克制** |
| 剧情 | 线性推图 | **历史分支：你可以改写三国** |
| 抽卡 | 纯随机 | **"三顾茅庐"机制：诚意度影响概率** |
| 核心loop | 挂机→升级→推图 | **抉择→战斗→命运改写→新势力→新抉择** |

## 差异放大器：3个独创系统

### 1. 天命抉择 (Destiny Choices) — 最大差异
- 每10关一个历史岔路口
- 例：赤壁之战 → 你选择帮曹操还是孙刘
- 不同选择 → 完全不同的后续关卡、可招募武将、剧情
- **至少3条主线** → 重玩3次不一样
- 这是AFK类游戏从未做过的

### 2. 兵种克制+地形 (Tactical Layer)
- 5兵种：骑→弓→枪→盾→术→骑 (循环克制)
- 地形：平原/山地/水域/城池 → 影响兵种效果
- 天气：晴/雨/雾/火 → 改变战斗规则
- 阵型：前排2+后排3，位置影响受击和输出

### 3. 三顾茅庐抽卡 (Sincerity Gacha)
- 不是纯随机抽卡
- 每次"拜访"武将 → 选对话选项 → 增加"诚意值"
- 诚意值越高 → 招募概率越大
- 但选错话 → 诚意清零，要重新来
- **玩家觉得是自己"说服"了武将，不是运气**

## 技术架构

### 文件结构
```
sanguo-expedition/
├── index.html          # 入口
├── manifest.json       # PWA
├── css/
│   └── style.css
├── js/
│   ├── core.js         # 游戏引擎、状态管理
│   ├── battle.js       # 战斗系统
│   ├── gacha.js        # 抽卡/招募系统
│   ├── heroes.js       # 武将数据库
│   ├── story.js        # 剧情/天命抉择
│   ├── campaign.js     # 战役/关卡
│   ├── idle.js         # 挂机收益
│   ├── ui.js           # UI渲染
│   ├── audio.js        # 音效
│   └── storage.js      # 本地存储
├── data/
│   ├── heroes.json     # 武将属性
│   ├── stages.json     # 关卡配置
│   └── stories.json    # 剧情文本
└── assets/
    └── (emoji-based, no images needed)
```

### 武将系统
```
稀有度: ★(白) → ★★(绿) → ★★★(蓝) → ★★★★(紫) → ★★★★★(金)
属性: HP, ATK, DEF, SPD, INT
兵种: 骑/弓/枪/盾/术
阵营: 魏/蜀/吴/群
技能: 被动1 + 主动1(手动释放) + 终极1(怒气满释放)

升级: 经验→等级 + 同名卡合成→升星
装备: 武器/甲/饰品/坐骑 (4槽)
缘分: 特定武将组队触发额外buff
```

### 战斗系统
```
回合制 + 实时怒气条
阵型: [前1][前2] | [后1][后2][后3]
每回合:
  1. 按SPD排序行动
  2. 普攻(自动) → 充怒气
  3. 怒气满 → 玩家选择释放技能时机(手动)
  4. 兵种克制: 伤害×1.3 / 被克: 伤害×0.7
  5. 地形加成: 骑兵平原+20%, 弓兵山地+20%
  6. 天气效果: 火攻雨天-50%, 雾天命中-30%
```

### 挂机系统
```
离线收益: 经验 + 铜币 + 低概率装备
挂机战场: 当前最高通关关卡
加速: 2x/4x 倍速(庄园升级解锁)
每日上限: 12小时(激活VIP无上限)
```

### 关卡设计 (第一章: 黄巾之乱)
```
1-1: 教学战 (张角手下小兵)
1-2: 学习兵种克制
1-3: 学习阵型
1-4: 第一个精英怪
1-5: BOSS: 张角 (术士，雷击全体)
--- 天命抉择: 救不救卢植？---
1-6~1-9: 根据选择不同的路线
1-10: BOSS: 张宝 或 张梁 (取决于选择)
```

### MVP 优先级
1. ✅ 架构文档
2. 核心战斗引擎 (5v5回合制)
3. 10个初始武将 + 属性
4. 第一章10关 + 1个天命抉择
5. 基础抽卡(三顾茅庐)
6. 挂机收益
7. UI打磨

### 武将初始列表 (第一章可获得)
| 名 | 稀有 | 兵种 | 阵营 | 技能 |
|----|------|------|------|------|
| 刘备 | ★★★★ | 盾 | 蜀 | 仁德：回复全体HP |
| 关羽 | ★★★★★ | 骑 | 蜀 | 青龙偃月：单体巨伤 |
| 张飞 | ★★★★ | 枪 | 蜀 | 怒吼：全体眩晕1回合 |
| 曹操 | ★★★★★ | 骑 | 魏 | 挟天子：提升全队ATK |
| 孙尚香 | ★★★★ | 弓 | 吴 | 连弩：3连击后排 |
| 赵云 | ★★★★★ | 骑 | 蜀 | 七进七出：无敌1回合+AOE |
| 张角 | ★★★★ | 术 | 群 | 天雷：全体术伤 |
| 吕布 | ★★★★★ | 骑 | 群 | 无双：最高单体伤害 |
| 貂蝉 | ★★★★ | 术 | 群 | 闭月：魅惑1敌1回合 |
| 黄忠 | ★★★ | 弓 | 蜀 | 百步穿杨：必中+暴击 |
