<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a12">
<title>三国·天命</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/premium.css">
</head>
<body>

<!-- ===== PAGE: HOME ===== -->
<div id="page-home" class="page active">
  <div class="page-header">
    <div class="page-title">三国·天命</div>
    <div class="resource-bar">
      <span>💰 <b id="hdr-gold">0</b></span>
      <span>💎 <b id="hdr-gems">0</b></span>
    </div>
  </div>

  <!-- Idle Reward Card -->
  <div class="card card-glow" id="idle-card" onclick="App.collectIdle()">
    <div class="idle-reward">
      <div class="label">离线收益 (点击领取)</div>
      <div class="big-num" id="idle-gold">+0</div>
      <div class="label" id="idle-time">0分钟</div>
    </div>
  </div>

  <!-- Daily Missions -->
  <div class="card" id="daily-missions-card">
    <div class="flex justify-between items-center mb-8">
      <div style="font-size:15px;font-weight:600">📋 每日任务</div>
      <div class="text-dim" style="font-size:11px" id="daily-reset-time">午夜重置</div>
    </div>
    <div id="daily-missions-list"></div>
  </div>

  <!-- Player Info -->
  <div class="card">
    <div class="flex justify-between items-center">
      <div>
        <div style="font-size:18px;font-weight:700" id="player-name">主公</div>
        <div class="text-dim" style="font-size:13px">Lv.<span id="player-level">1</span></div>
      </div>
      <div style="text-align:right">
        <div class="text-dim" style="font-size:11px">经验</div>
        <div class="progress" style="width:100px"><div class="progress-fill" id="player-exp-bar" style="width:0%;background:var(--accent)"></div></div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="card">
    <div style="font-size:15px;font-weight:600;margin-bottom:12px">快捷入口</div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px">
      <div class="hero-card" onclick="App.switchPage('campaign')" style="margin:0;justify-content:center">
        <span style="font-size:24px">⚔️</span>
        <span style="font-size:12px;font-weight:600">战役</span>
      </div>
      <div class="hero-card" onclick="App.switchPage('dungeon')" style="margin:0;justify-content:center">
        <span style="font-size:24px">🏔️</span>
        <span style="font-size:12px;font-weight:600">副本</span>
      </div>
      <div class="hero-card" onclick="App.switchPage('arena')" style="margin:0;justify-content:center">
        <span style="font-size:24px">🏟️</span>
        <span style="font-size:12px;font-weight:600">竞技</span>
      </div>
      <div class="hero-card" onclick="App.switchPage('gacha')" style="margin:0;justify-content:center">
        <span style="font-size:24px">🏯</span>
        <span style="font-size:12px;font-weight:600">求贤</span>
      </div>
      <div class="hero-card" onclick="App.switchPage('roster')" style="margin:0;justify-content:center">
        <span style="font-size:24px">🛡️</span>
        <span style="font-size:12px;font-weight:600">英雄</span>
      </div>
      <div class="hero-card" onclick="App.switchPage('profile')" style="margin:0;justify-content:center">
        <span style="font-size:24px">📊</span>
        <span style="font-size:12px;font-weight:600">档案</span>
      </div>
    </div>
  </div>

  <!-- Chapter Progress -->
  <div class="card">
    <div class="flex justify-between items-center mb-8">
      <div style="font-size:15px;font-weight:600">当前章节</div>
      <div class="text-dim" style="font-size:12px" id="chapter-progress">第1章 1/10</div>
    </div>
    <div class="progress"><div class="progress-fill" id="chapter-bar" style="width:10%;background:linear-gradient(90deg,var(--accent),var(--accent2))"></div></div>
  </div>
</div>

<!-- ===== PAGE: CAMPAIGN ===== -->
<div id="page-campaign" class="page">
  <div class="page-header">
    <div class="page-title" id="campaign-title">黄巾之乱</div>
    <div class="resource-bar">
      <span id="campaign-terrain">🌾 平原</span>
      <span id="campaign-weather">☀️ 晴天</span>
    </div>
  </div>
  <div class="stage-list" id="stage-list"></div>
</div>

<!-- ===== PAGE: BATTLE ===== -->
<div id="page-battle" class="page">
  <div class="page-header">
    <div class="page-title" id="battle-title">战斗</div>
    <div id="battle-turn" class="text-dim" style="font-size:13px">回合 0</div>
  </div>
  <div class="battle-field" id="battle-field">
    <div class="team-col" id="team-player"></div>
    <div class="vs-icon">⚔️</div>
    <div class="team-col" id="team-enemy"></div>
  </div>
  <div class="card mt-16">
    <div class="battle-log" id="battle-log"></div>
  </div>
  <div class="text-center mt-16">
    <button class="btn btn-primary btn-block" id="btn-battle-start" onclick="App.startBattle()">开始战斗</button>
  </div>
</div>

<!-- ===== PAGE: ROSTER ===== -->
<div id="page-roster" class="page">
  <div class="page-header">
    <div class="page-title">武将</div>
    <div class="text-dim" style="font-size:12px">点击查看详情</div>
  </div>
  <div id="roster-list"></div>
</div>

<!-- ===== PAGE: HERO DETAIL ===== -->
<div id="page-hero-detail" class="page">
  <div class="page-header">
    <div class="page-title" id="hd-title">武将详情</div>
    <button class="btn btn-sm" onclick="App.switchPage('roster')" style="background:var(--card2);color:var(--text)">← 返回</button>
  </div>
  <div id="hero-detail-content"></div>
</div>

<!-- ===== PAGE: TEAM ===== -->
<div id="page-team" class="page">
  <div class="page-header">
    <div class="page-title">编队</div>
    <div class="text-dim" style="font-size:12px">前排2 + 后排3</div>
  </div>
  <div style="margin-bottom:12px">
    <button class="btn btn-primary btn-block" onclick="App.autoFormation()" style="background:linear-gradient(135deg,#059669,#10b981)">🤖 智能编队</button>
  </div>
  <div id="formation-advice" class="hidden"></div>
  <div style="margin-bottom:12px;font-size:13px;color:var(--dim)">点击空位添加武将，点击已有武将移除</div>
  <div id="team-slots" style="display:flex;flex-direction:column;gap:8px"></div>
  <div class="mt-16" style="font-size:14px;font-weight:600">可用武将</div>
  <div id="team-available" class="mt-8"></div>
</div>

<!-- ===== PAGE: GACHA ===== -->
<div id="page-gacha" class="page">
  <div class="page-header">
    <div class="page-title">🏯 求贤馆</div>
  </div>
  <div style="font-size:13px;color:var(--dim);margin-bottom:16px">三顾茅庐 — 以诚意打动英雄加入</div>
  <div id="gacha-list"></div>
</div>

<!-- ===== PAGE: GACHA VISIT ===== -->
<div id="page-visit" class="page">
  <div class="page-header">
    <div class="page-title" id="visit-hero-name">拜访</div>
    <button class="btn btn-sm" onclick="App.switchPage('gacha')" style="background:var(--card2);color:var(--text)">← 返回</button>
  </div>
  <div class="gacha-hero" id="visit-hero-display"></div>
  <div class="card">
    <div class="flex justify-between items-center mb-8">
      <span style="font-size:13px">诚意度</span>
      <span style="font-size:13px;color:var(--gold)" id="visit-sincerity">0</span>
    </div>
    <div class="sincerity-bar"><div class="sincerity-fill" id="visit-sincerity-bar" style="width:0%"></div></div>
  </div>
  <div class="dialogue-box" id="visit-dialogue"></div>
</div>

<!-- ===== PAGE: LEADERBOARD ===== -->
<div id="page-leaderboard" class="page">
  <div class="page-header">
    <div class="page-title">🏆 天下排行</div>
    <div class="text-dim" style="font-size:12px" id="lb-reset">本周剩余: --</div>
  </div>
  <div class="card" style="text-align:center;padding:12px">
    <div style="font-size:12px;color:var(--gold)">⏰ 每周一凌晨刷新排名</div>
  </div>
  <div id="leaderboard-list" style="margin-top:8px"></div>
</div>

<!-- ===== DESTINY CHOICE OVERLAY ===== -->
<div id="destiny-modal" class="destiny-modal hidden">
  <div class="destiny-content">
    <div class="destiny-title" id="destiny-title"></div>
    <div class="destiny-desc" id="destiny-desc"></div>
    <div id="destiny-options"></div>
    <div class="destiny-lore" id="destiny-lore"></div>
  </div>
</div>

<!-- ===== BATTLE RESULT OVERLAY ===== -->
<div id="result-modal" class="destiny-modal hidden">
  <div class="destiny-content text-center">
    <div style="font-size:48px" id="result-icon">⚔️</div>
    <div style="font-size:22px;font-weight:700;margin:12px 0" id="result-title">战斗结果</div>
    <div style="font-size:14px;color:var(--dim)" id="result-detail"></div>
    <button class="btn btn-primary btn-block mt-16" onclick="App.closeResult()">继续</button>
  </div>
</div>

<!-- ===== TUTORIAL / ONBOARDING ===== -->
<div id="tutorial-overlay" class="tutorial-overlay hidden">
  <div class="tutorial-content">
    <!-- Step 1 -->
    <div class="tutorial-step active">
      <div style="font-size:64px;margin-bottom:16px">⚔️</div>
      <h1 style="font-size:24px;font-weight:700;margin-bottom:8px;color:var(--gold)">三国·天命</h1>
      <p style="color:var(--dim);margin-bottom:24px;font-size:14px;line-height:1.6">乱世之中，你将书写自己的三国传奇。<br>每一个选择，都会改变命运的走向。</p>
      <div class="tutorial-features">
        <div class="tutorial-feature"><span>🛡️</span><div><b>编队</b><br><span class="text-dim">排兵布阵，兵种克制</span></div></div>
        <div class="tutorial-feature"><span>⚔️</span><div><b>征战</b><br><span class="text-dim">闯关推图，天命抉择</span></div></div>
        <div class="tutorial-feature"><span>🏯</span><div><b>求贤</b><br><span class="text-dim">三顾茅庐，以诚招贤</span></div></div>
        <div class="tutorial-feature"><span>💰</span><div><b>挂机</b><br><span class="text-dim">离线也能积累资源</span></div></div>
      </div>
      <button class="btn btn-gold btn-block" onclick="App.advanceTutorial()">了解更多</button>
    </div>
    <!-- Step 2 -->
    <div class="tutorial-step">
      <div style="font-size:48px;margin-bottom:12px">🗡️🏹</div>
      <h2 style="font-size:20px;font-weight:700;margin-bottom:8px">你的起始武将</h2>
      <p style="color:var(--dim);margin-bottom:16px;font-size:13px">你已经拥有 <b>新兵</b> 和 <b>弓手</b> 两名武将。<br>兵种之间存在克制关系：</p>
      <div style="background:var(--card2);border-radius:12px;padding:16px;margin-bottom:20px;font-size:14px;text-align:center;line-height:2">
        🐴骑 → 🏹弓 → 🔱枪 → 🛡️盾 → 🔮术 → 🐴骑<br>
        <span class="text-dim" style="font-size:12px">克制 ×1.3 伤害 · 被克 ×0.7 伤害</span>
      </div>
      <button class="btn btn-gold btn-block" onclick="App.advanceTutorial()">继续</button>
    </div>
    <!-- Step 3 -->
    <div class="tutorial-step">
      <div style="font-size:48px;margin-bottom:12px">🎯</div>
      <h2 style="font-size:20px;font-weight:700;margin-bottom:8px">开始你的征途</h2>
      <div style="background:var(--card2);border-radius:12px;padding:16px;margin-bottom:20px;font-size:13px;line-height:1.8;color:var(--dim)">
        <div>1️⃣ 先去 <b style="color:var(--text)">编队</b> 确认阵容</div>
        <div>2️⃣ 进入 <b style="color:var(--text)">征战</b> 挑战关卡</div>
        <div>3️⃣ 赚取金币后去 <b style="color:var(--text)">求贤馆</b> 招募名将</div>
        <div>4️⃣ 每次关卡通关都有 <b style="color:var(--gold)">天命抉择</b>，影响后续剧情</div>
      </div>
      <div style="background:rgba(212,168,67,.1);border:1px solid rgba(212,168,67,.3);border-radius:12px;padding:12px;margin-bottom:16px;text-align:center">
        <div style="font-size:24px">🐉</div>
        <div style="font-size:14px;font-weight:700;color:var(--gold)">新手礼包</div>
        <div style="font-size:12px;color:var(--dim);margin-top:4px">🌟 SSR武将·赵云 + 💰500金币 + 💎20宝石</div>
      </div>
      <div style="font-size:12px;color:var(--gold);font-style:italic;margin-bottom:16px;text-align:center">「选择塑造命运。没有对错，只有不同的三国。」</div>
      <button class="btn btn-gold btn-block" onclick="App.closeTutorial()">领取并开始征途！</button>
    </div>
    <!-- Step indicators -->
    <div class="step-dots">
      <span class="step-dot active"></span>
      <span class="step-dot"></span>
      <span class="step-dot"></span>
    </div>
  </div>
</div>

<!-- ===== PAGE: DUNGEON ===== -->
<div id="page-dungeon" class="page">
  <div class="page-header">
    <div class="page-title">🏔️ 副本</div>
    <div class="resource-bar">
      <span>💰 <b id="dg-gold">0</b></span>
      <span>💎 <b id="dg-gems">0</b></span>
    </div>
  </div>

  <!-- Dungeon Tabs -->
  <div class="tab-bar" id="dungeon-tabs">
    <div class="tab-item active" onclick="App.switchDungeonTab('endless')">♾️ 无尽</div>
    <div class="tab-item" onclick="App.switchDungeonTab('daily')">📅 每日</div>
    <div class="tab-item" onclick="App.switchDungeonTab('raid')">💀 Boss</div>
    <div class="tab-item" onclick="App.switchDungeonTab('seasonal')">🌸 赛季</div>
  </div>

  <div id="dungeon-content"></div>
</div>

<!-- ===== PAGE: ARENA ===== -->
<div id="page-arena" class="page">
  <div class="page-header">
    <div class="page-title">⚔️ 竞技场</div>
    <div class="text-dim" style="font-size:12px" id="arena-attempts">剩余: 5次</div>
  </div>

  <!-- Arena Rank Display -->
  <div class="card card-glow" id="arena-rank-card">
    <div style="text-align:center">
      <div style="font-size:48px" id="arena-rank-emoji">🥉</div>
      <div style="font-size:20px;font-weight:700" id="arena-rank-name">青铜</div>
      <div style="font-size:14px;color:var(--gold)" id="arena-rating">Rating: 800</div>
      <div class="progress mt-8" style="width:80%;margin:8px auto 0"><div class="progress-fill" id="arena-progress-bar" style="width:0%;background:linear-gradient(90deg,var(--accent),var(--gold))"></div></div>
      <div class="text-dim" style="font-size:11px;margin-top:4px" id="arena-next-rank">下一段位: 白银 (1000)</div>
    </div>
  </div>

  <!-- Arena Stats -->
  <div class="card">
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;text-align:center">
      <div><div style="font-size:20px;font-weight:700;color:var(--shu)" id="arena-wins">0</div><div class="text-dim" style="font-size:11px">胜</div></div>
      <div><div style="font-size:20px;font-weight:700;color:var(--hp)" id="arena-losses">0</div><div class="text-dim" style="font-size:11px">负</div></div>
      <div><div style="font-size:20px;font-weight:700;color:var(--gold)" id="arena-streak">0</div><div class="text-dim" style="font-size:11px">连胜</div></div>
    </div>
  </div>

  <!-- Opponents -->
  <div style="font-size:15px;font-weight:600;margin-bottom:8px">选择对手</div>
  <div id="arena-opponents"></div>

  <!-- Weekly Reward -->
  <div class="card mt-16" id="arena-weekly-card">
    <div class="flex justify-between items-center">
      <div>
        <div style="font-size:14px;font-weight:600">🎁 周奖励</div>
        <div class="text-dim" style="font-size:12px" id="arena-weekly-desc">基于当前段位</div>
      </div>
      <button class="btn btn-gold btn-sm" id="arena-weekly-btn" onclick="App.claimArenaWeekly()">领取</button>
    </div>
  </div>

  <!-- Arena Leaderboard -->
  <div style="font-size:15px;font-weight:600;margin:16px 0 8px">🏆 竞技排行</div>
  <div id="arena-leaderboard"></div>
</div>

<!-- ===== PAGE: EQUIPMENT ===== -->
<div id="page-equipment" class="page">
  <div class="page-header">
    <div class="page-title">🎒 装备库</div>
    <button class="btn btn-sm" onclick="App.switchPage('roster')" style="background:var(--card2);color:var(--text)">← 返回</button>
  </div>
  <div id="equipment-content"></div>
</div>

<!-- ===== PAGE: ACHIEVEMENTS ===== -->
<div id="page-achievements" class="page">
  <div class="page-header">
    <div class="page-title">🏅 成就</div>
    <button class="btn btn-sm" onclick="App.switchPage('profile')" style="background:var(--card2);color:var(--text)">← 返回</button>
  </div>
  <div id="achievements-content"></div>
</div>

<!-- ===== PAGE: PROFILE ===== -->
<div id="page-profile" class="page">
  <div class="page-header">
    <div class="page-title">📊 档案</div>
  </div>
  <div id="profile-content"></div>
</div>

<!-- ===== TOAST ===== -->
<div id="toast" class="toast hidden"></div>

<!-- ===== BOTTOM NAV ===== -->
<nav class="bottom-nav">
  <div class="nav-item active" onclick="App.switchPage('home')"><span class="icon">🏠</span>主城</div>
  <div class="nav-item" onclick="App.switchPage('campaign')"><span class="icon">⚔️</span>战役</div>
  <div class="nav-item" onclick="App.switchPage('dungeon')"><span class="icon">🏔️</span>副本</div>
  <div class="nav-item" onclick="App.switchPage('arena')"><span class="icon">🏟️</span>竞技</div>
  <div class="nav-item" onclick="App.switchPage('roster')"><span class="icon">🛡️</span>英雄</div>
  <div class="nav-item" onclick="App.switchPage('gacha')"><span class="icon">🏯</span>商店</div>
</nav>

<!-- Scripts -->
<script src="js/heroes.js"></script>
<script src="js/storage.js"></script>
<script src="js/battle.js"></script>
<script src="js/campaign.js"></script>
<script src="js/gacha.js"></script>
<script src="js/idle.js"></script>
<script src="js/equipment.js"></script>
<script src="js/dungeon.js"></script>
<script src="js/arena.js"></script>
<script src="js/seasonal.js"></script>
<script src="js/skilltree.js"></script>
<script src="js/app.js"></script>
<script>if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(()=>{});</script>
</body>
</html>
